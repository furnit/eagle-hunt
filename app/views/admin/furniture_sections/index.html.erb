<div class='col-md-offset-2 col-md-8'>
  <legend>
    <h1 class='pull-right'>انواع قسمت‌های مبل</h1>
    <small class='pull-left' style='font-size: 16px; margin-top: 40px;'>
      <%= link_to new_admin_furniture_section_path, class: 'inline-html-call' do %>
        <span class='fa fa-plus'></span>
        ایجاد قسمت جدید
      <% end %>
    </small>
    <div class='clearfix'></div>
  </legend>

<%= acu_as :admin { render 'shared/editable_content' }%>

  <table class='table table-striped table-hover'>
    <thead>
      <tr>
	      <th style='width: 30px'>ردیف</th>
	      <th style='width: 12%;'>عنوان</th>
      	<th style='width: 100px;'>گالری</th>
        <th>توضیحات</th>
        <th style='width: 50px;'>عملیات</th>
      </tr>
    </thead>

    <tbody>
      <% @admin_furniture_sections.each do |admin_furniture_section| %>
        <tr>
          <td><%= admin_furniture_section.id %></td>
          <td>
            <a href="#" class='editable' data-type="text" data-resource="admin_furniture_section" data-name="name" data-url="<%= admin_furniture_section_path(admin_furniture_section) %>" data-original-title="<%= admin_furniture_section.name %>">
              <%= admin_furniture_section.name %>
            </a>
          </td>
	        <td class='photo-gallery-collection-incomplete'>
	        	<% i = admin_furniture_section.images.first %>
						<%= link_to image_url(i), data: { id: admin_furniture_section.id, source: list_images_admin_furniture_section_path(admin_furniture_section) } do %>
							<%= image_tag thumbnail_url(i), :class => 'cover-item img-responsive img-thumbnail', style: 'height: 40px; width: 70px' %>
						<% end %>
	        </td>
          <td>
            <a href="#" class='editable' data-type="textarea" data-placement="bottom" data-resource="admin_furniture_section" data-name="comment" data-url="<%= admin_furniture_section_path(admin_furniture_section) %>" data-original-title="<%= admin_furniture_section.comment %>"><%= admin_furniture_section.comment %></a>
          </td>
          <td>
            <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class='fa fa-superpowers'></span> <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
              	<li>
			            <%= link_to edit_admin_furniture_section_path(admin_furniture_section), class: 'inline-html-call' do %>
			              <span class='fa fa-pencil'></span> ویرایش
			            <% end %>
            		</li>
            		<li style='margin: 0'><hr /></li>
                <li>
			            <%= link_to admin_furniture_section, method: :delete, data: { confirm: 'آیا از انجام این عمل مطمئن هستید؟' }, class: 'text-danger' do %>
			              <span class='fa fa-trash'></span> حذف
			            <% end %>
              	</li>
              </ul>
            </div>
          </td>
        </tr>
      <% end %>
      <% if @admin_furniture_sections.empty? %>
      	<tr class='text-center' style='background-color: transparent!important; border: 1px solid #e7e7e7; height: 60px;'>
      		<td colspan="5" style='padding-top: 20px;'>داده‌ای ثبت نشده‌ است!</td>
    		</tr>
      <% end %>
    </tbody>
  </table>
</div>

<script type="text/javascript" charset="utf-8">
	$(document).ready(function(){
		function append2gallery() {
			$('.photo-gallery-collection-incomplete a[data-source]').bind('append2gallery', function(e, data, index, gallery) {
				link = 
				'<%= link_to "{0}", data: { index: "{1}", thumb: "{2}" } do %>\
					<%= image_tag "{2}", :class => "cover-item img-responsive img-thumbnail", style: "height: 40px; width: 70px" %>\
				<% end %>'
				.replace('%7B', '{').replace('%7D', '}')
				.replace('src="/images/{2}"', 'src="{2}"')
				.format(data.images[index].url, index, data.images[index].thumb.url)
				$(gallery).append(link);
			});
		};
		append2gallery();
		$(document).ajaxSuccess(append2gallery);
	})
</script>

<%= render 'shared/photo_gallery', collection: @admin_furniture_sections %>