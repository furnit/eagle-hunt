<small style='font-size: 16px;' class='text-muted pull-left'><%= render_filterrific_spinner %> <%= page_entries_info @users %></small>
<%= acu_as :admin { render 'editable_content' }%>
<table class='table <%= @users.empty? ? "" : "table-striped table-hover" %>'>
  <thead>
    <tr>
      <th style='width: 30px'>ردیف</th>
      <th style='width: 12%;'>نام و نام‌خانوادگی</th>
      <th style='width: 120px;'>شماره تماس</th>
      <th style='width: 100px'>استان</th>
      <th>آدرس</th>
      <th style='width: 80px'>نوع کاربر</th>
      <th style='width: 7%;'>آخرین ورود</th>
      <th style='width: 50px;'>عملیات</th>
    </tr>
  </thead>
  <tbody>
    <% @users.each do |user| %>
      <%
        title  = ''
        title  = 'کاربر مسدود شده است!' if user.blocked_at
        title  = 'حساب کاربر معلق شده است!' if user.deleted_at
        title  = 'حساب کاربر معلق و مسدود شده است!' if user.blocked_at and user.deleted_at
        _class = ''
        _class += 'blocked' if user.blocked_at
        _class += ' strikeout' if user.deleted_at

      %>
      <tr class='<%= _class %>' <%= raw title.empty? ? '' : "title='#{title}' data-toggle='tooltip'"%> >
        <td><%= user.id %></td>
        <td>
          <a href="#" class='editable' data-type="text" data-resource="profile" data-name="full_name" data-url="<%= profile_path(user.profile) %>" data-original-title="<%= user.full_name %>">
            <%= user.full_name %>
          </a>
        </td>
        <td>
          <a href="#" class='editable' data-type="text" data-resource="user" data-name="phone_number" data-url="<%= admin_user_path(user) %>" data-max-length='11' data-original-title="<%= number_to_phone(user.phone_number) %>">
            <%= number_to_phone(user.phone_number) %>
          </a>
        </td>
        <td>
          <a href="#" class='editable' data-type="select" data-pk="1" data-resource="profile" data-name="state_id" data-value="<%= user.profile.state_id %>" data-source="<%= states_admin_users_path %>" data-url="<%= profile_path(user.profile) %>" data-original-title="<%= user.profile.state ? user.profile.state.name : "" %>">
            <%= user.profile.state ? user.profile.state.name : "«نامشخص»" %>
          </a>
        </td>
        <td>
          <a href="#" class='editable' data-type="textarea" data-placement="bottom" data-resource="profile" data-name="address" data-url="<%= profile_path(user.profile) %>" data-original-title="<%= user.profile.address %>"><%= user.profile.address ? user.profile.address : "«آدرسی ثبت نشده است.»" %></a>
        </td>
        <td>
          <a href="#" class='editable' data-type="select" data-pk="1" data-resource="user" data-name="admin_user_type_id" data-value="<%= user.admin_user_type_id %>" data-source="<%= admin_user_types_path %>" data-url="<%= admin_user_path(user) %>" data-original-title="<%= user.user_type.name %>">
            <%= user.user_type.name %>
          </a>
        </td>
        <td class='datetime' data-time='<%= user.current_sign_in_at %>'><%= user.current_sign_in_at %></td>
        <td>
          <% acu_as :admin do %>
            <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class='fa fa-superpowers'></span> <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                <li>
                  <% if not (user.id == 1 and current_user.id == user.id) %>
                    <%= link_to block_admin_user_path(user), method: :delete  do %>
                     <% if user.blocked_at %>
                        <span class='fa fa-unlock'></span> باز کردن
                     <% else %>
                        <span class='fa fa-lock'></span> مسدود کردن
                     <% end %>
                    <% end %>
                  <% end %>
                </li>
                <li>
                  <%= link_to reset_password_admin_user_path(user), method: :put do %>
                    <span class='fa fa-key'></span> تنظیم مجدد رمزعبور
                  <% end %>
                </li>
              </ul>
            </div>
          <% end %>
        </td>
      </tr>
    <% end %>
    <% if @users.empty? %>
      <tr>
        <td colspan="8"><div class="empty-collection">عضوی پیدا نشد!</div></td>
      </tr>
    <% end %>
  </tbody>
</table>
<div class="text-center" style='vertical-align: middle'>
  <%= will_paginate @users, renderer: BootstrapPagination::Rails %>
</div>