<div id="step3" class="step">
	<legend><strong>۱. انتخاب نوع چوب</strong></legend>
	<p>در این قسمت لطفا نوع چوب مورد استفاده در ساخت مبل را انتخاب کنید.</p>
	<% wood_type_select_name = Admin::Furniture::Wood::Type.model_name.param_key %>
	<select id="wood-type-selection" name="<%= wood_type_select_name %>" class="selectpicker" data-size="<%= @wood_types.length + 1%>">
		<option disabled selected>یک نوع چوب را انتخاب کنید.</option>
		<% @wood_types.each do |t| %>
	  	<option value=<%= t.id %> data-subtext=" با قیمت <%= t.price.price.to_s.to_money %> تومان" <%= (@prev_data and @prev_data[:wood_type_id].to_i == t.id) ? "selected" : "" %>><%= t.name %></option>
		<% end %>
	</select>

	<div id="wood-type-comments" class="hidden" style="margin: 20px;">
		توضیحات:
		<blockquote style="border: 0; border-right: 5px solid red; font-size: 110%">
			<% @wood_types.each do |t| %>
				<div class="wood-type-comment hidden" id="wood-type-comment-<%= t.id %>"><%= t.comment %></div>
			<% end %>
		</blockquote>
	</div>

	<legend style="margin-top: 20px;"><strong>۲. انتخاب رنگ چوب</strong></legend>
	<div class="row" id="furniture-wood-color">
		<% @wood_colors.each do |c| %>
		<div style="padding: 10px;" class="col-md-1 col-sm-2 col-xs-2 text-center pull-right">
			<div style="height: 40px; width: 40px; background-color: #<%= c.value %>; margin: 0 auto; cursor: pointer" class="shadow-box color-box <%= (@prev_data and @prev_data[:wood_color_id].to_i == c.id) ? "selected" : "" %>" color-id="<%= c.id %>"></div>
			<strong color-id="<%= c.id %>" style="position: relative; top: 10px;"><%= c.name %></strong>
		</div>
		<% end %>
	</div>

	<legend style="margin-top: 20px;"><strong>۳. انتخاب روشنی/تیرگی رنگ</strong></legend>
	<select id="wood-color-weight" name="<%= @wood_color_weights.first && @wood_color_weights.first.model_name.param_key %>" class="selectpicker" data-size="<%= @wood_color_weights.length + 1 %>">
		<option disabled selected>یک وزن رنگی را انتخاب کنید.</option>
		<% @wood_color_weights.each do |cw| %>
	  	<option value=<%= cw.id %> <%= (@prev_data and @prev_data[:wood_color_weight_id].to_i == cw.id) ? "selected" : "" %>><%= cw.name %></option>
		<% end %>
	</select>
	<legend style="margin-top: 20px;"><strong>۴. توضیحات/درخواست‌ها (اختیاری)</strong></legend>
	<textarea placeholder="در صورت داشتن درخواست در مورد «رنگ مبل» در این قسمت ذکر نمایید." id="wood-comment"><%= (@prev_data and @prev_data[:comment]) ? @prev_data[:comment] : "" %></textarea>
</div>

<%= render 'order/orders/shared/nav' %>

<style type="text/css" media="screen">
	#furniture-wood-color .color-box[color-id].selected {
		box-shadow: 0 0 10px #0088cc
	}
	#furniture-wood-color [color-id]:not(.color-box).selected {
		color: #0066aa
	}
</style>

<script type="text/javascript" charset="utf-8">
	function build_order_details_step3() {
		return {
			wood_type_id: $("#wood-type-selection :not([disabled]):selected").val(),
			wood_color_id: $(".color-box.selected").attr('color-id'),
			wood_color_weight_id: $("#wood-color-weight :not([disabled]):selected").val(),
			comment: $("#wood-comment").val()
		};
	}
	$(document).ready(function() {
		$("#step-nav .btn-next").attr('disabled', 'disabled');
		$("#step3 select.selectpicker").change(function(){
			$(this).closest('.bootstrap-select').find('button').blur();
		})
		$("#step3 select[name='<%= wood_type_select_name %>']").change(function(){
			$("#wood-type-comments")
				.removeClass('hidden')
				.find(".wood-type-comment")
					.addClass('hidden')
			$("#wood-type-comments #wood-type-comment-" + $(this).val().toString()).removeClass('hidden')
		})
		<% if(@prev_data and @prev_data[:wood_type_id]) %>
			$("#step3 select[name='<%= wood_type_select_name %>']").change();
		<% end %>
		$('#furniture-wood-color .color-box').click(function() {
			$('#furniture-wood-color .selected').removeClass('selected')
			$("[color-id='"+$(this).attr('color-id')+"']").addClass('selected')
		});
		$('#furniture-wood-color .color-box.selected').click();
		var check_all = function() {
			// check if we are in step#3 or not?
			// if not? don't check it
			if($("#step3").length === 0) return;
			if($("#step3 select :selected:not([disabled])").length === $("#step3 select").length && $('#furniture-wood-color [color-id].selected').length > 0)
				$("#step-nav .btn-next").removeAttr('disabled');
			else
				$("#step-nav .btn-next").attr('disabled', 'disabled');
			// reset the interval
			setTimeout(check_all, 100);
		};
		// checks every 100ms to see if the .btn-next should be enabled or not
		setTimeout(check_all, 100);
	});
</script>