<%= remote_form @furniture, url: employee_fanis_path, method: :post do |f| %>
	<%= f.hidden_field :id, value: @furniture.id %>
	<%= f.hidden_field :hd, value: Digest::SHA256.new << (@furniture.id.to_s + Rails.application.config.secret_key_base) %>
	<div class='ir'>
		<%= f.fields_for Employee::Fani.new do |ff| %>
			<div class="panel panel-success">
			  <div class="panel-heading"><strong><span class='fa fa-money'></span> دست‌مزد</strong></div>
			  <div class="panel-body">
					<div class='row'>
						<%= ff.number_field :wage_rokob, step: :any, append: "هزار تومان", wrapper: { class: 'col-md-6 pull-right' } %>
						<%= ff.number_field :wage_khayat, step: :any, append: "هزار تومان", wrapper: { class: 'col-md-6' } %>
					</div>
			  </div>
			</div>
			<div class="panel panel-info">
			  <div class="panel-heading"><strong><span class='fa fa-clock-o'></span> زمان‌بندی</strong></div>
			  <div class="panel-body">
					<div class='row'>
			      <%= ff.number_field :days_to_complete, step: 1, value: 0, wrapper: { class: 'col-md-6 pull-right' }  %>
			      <%= ff.select :days_to_complete_scale, [['روز', 'days'], ['هفته', 'weeks'], ['ماه', 'month']], {}, wrapper: { class: 'col-md-offset-3 col-md-3' } %>
					</div>
			  </div>
			</div>
			<div class="panel panel-primary">
			  <div class="panel-heading"><strong><span class='fa fa-info'></span> اطلاعات عمومی</strong></div>
			  <div class="panel-body">
					<% [[:needs_kande, 'کنده‌کاری'], [:needs_kanaf, 'کناف'], [:needs_rang, 'رنگ']].each do |e| %>
						<%= check_awesome "نیاز به #{e[1]} دارد.", '', name: e[0] %>
					<% end %>
			  </div>
			</div>
			<%= ff.fields_for FurnitureBuildDetail.new do |fff| %>
				<% Admin::FurnitureSpec.where('name IN (?)', ['پارچه', 'ابر']).each do |spec| %>
					<% 
						is_abr = spec.name == 'ابر'
						value_col = 9 
						value_col = 6	if is_abr
						symbol = is_abr ? :abr : :parche 
					%>
					<div class="panel panel-primary">
					  <div class="panel-heading"><span class='fa fa-balance-scale'></span> جزییات <strong><%= spec.name %></strong></div>
					  <div class="panel-body">
				  		<table class='table'>
				  			<thead>
				  				<th class='col-md-<%= value_col %>'>مقدار</th>
				  				<% if is_abr %>
				  				<th class='col-md-<%= 9 - value_col %>'>جنس<br />(درحالت کلی)</th>				  				
				  				<% end %>
				  				<th class='col-md-3'>قسمت</th>
				  			</thead>
				  			<tbody>
									<% Admin::FurnitureSection.where('name IN (?)', ['زیری', 'پشتی', 'دسته']).each.with_index do |section, index| %>
										<tr>
											<td style='padding-topx: 33px;'>
												<%= fff.number_field :value, step: :any, multiple: true, append: raw("#{spec.scale} از <b>#{spec.name}</b>"), label: "برای #{section.comment}", input_html: { name: "#{ff.object_name}[value][#{spec.id}]" } %>
											</td>
											<% if is_abr %>
											<td style='padding-top: 33px;'>
												<%= fff.collection_select :admin_furniture_stuff_abr_id,  Admin::FurnitureStuffAbr.all, :id, :name, multiple: true, hide_label: true, selected: [2, 1, 3][index], input_html: { name: "#{ff.object_name}[abr_id][#{spec.id}]" } %>
											</td>
											<% end %>
						      		<td>
												<%= image_tag thumbnail_url(section.images), \
															class: 'furniture-section img-responsive', \
															style: 'height: 80px;margin-top: 0px;', \
															
															title: section.comment %>
											</td>
										</tr>
									<% end %>
								</tbody>
							</table>
					  </div>
					</div>
				<% end %>
			<% end %>
			<div class="panel panel-danger" style='margin-bottom: 150px'>
			  <div class="panel-heading"><strong><span class='fa fa-pencil-square-o'></span> ثبت اطلاعات</strong></div>
			  <div class="panel-body">
			  	<p>
			  		<strong><%= current_user.profile.first_name %> جان!</strong>
			  		در صورتی که از اطلاعات وارده‌ی فوق اطمینان حاصل دارید گزینه‌ی ثبت را بزنید. لطفا در نظر داشته باشید که این اطلاعات پایه‌ی اصلی قیمت‌گذاری محصولات خواهند بود.<br />
			  		هرگونه عواقب ناشی از <strong>«عدم صحت»</strong> یا <strong>«عدم مطابقت با واقعیت»</strong> اطلاعات وارد شده، مستقیما متوجه شما خواهد شد.
						<br />
						<small class="text-muted pull-left">
							باتشکر از توجه شما<br />
							تیم مدیریت «مبل ویرا»
						</small>
						<div class='clearfix'></div>
			  	</p>
			  	<%= f.submit 'ثبت اطلاعات' %>
			  	<!-- <%= link_to 'ثبت اطلاعات', "#", class: 'btn btn-primary', id: 'submit-fanis-form'%> -->
			  </div>
			</div>
		<% end %>
	</div>
<% end %>

<script type="text/javascript" charset="utf-8">
	$(document).ready(function(){
		$('a.btn#submit-fanis-form').click(function(){
			bootbox.confirm({
				message: 'آیا از ثبت اطلاعات اطمینان دارید؟', 
				callback: function (result) {
					if(result) {
						alert('USER SAID OK!')
					}
				}
			})
		});
		$('.furniture-section').on('mouseover', function(e) {
			$(this).popover({
	      html: true,
	      trigger: 'hover',
	      placement: 'top',
	      content: function(){ return '<img src="'+$(this).attr('src') + '" />';}
	    });
	    $(this).popover('show');
    });
  });
</script>